<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><title>利用canvas实现图片压缩</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/lib/highlight/styles/atom-one-dark.css"></head><body><header class="navbar navbar-fixed"><div class="navbar-nav"><div class="container"><a class="brand"></a><ul><li><a href="/">首页</a></li><li><a href="/archives/">归档</a></li><li><a href="/tags/">标签</a></li><li><a href="/about/">关于</a></li></ul></div></div><div class="navbar-line"><div class="navbar-wrap"><div class="container current"><div class="cur"></div></div></div></div></header><div class="main"><div class="container post"><h1>利用canvas实现图片压缩</h1><div class="meta"><time>2020-09-03</time><div class="tags"><a class="tag-link" href="/tags/canvas/">canvas </a><a class="tag-link" href="/tags/compress/">compress </a></div></div><article id="markdown"><p>在本地照片上传过程中经常需要用到图片压缩，这里利用h5的canvas来实现</p>
<pre><code class="js">/**
 * @param {File} file 图片文件
 * @param {Object} opt 选项
 * @property {number} opt.width 图片宽度
 * @property {number} opt.height 图片宽度
 * @property {number} opt.quality 图片图片质量[0,1]
 */
function imgCompress(file, { width, height, quality }) {
  return new Promise((resolve, reject) =&gt; {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onerror = () =&gt; {
      reject(&quot;FileReader read file Error!&quot;);
    };
    reader.onload = () =&gt; {
      var img = new Image();
      img.src = reader.result;
      img.onerror = () =&gt; {
        reject(&quot;Image read Error!&quot;);
      };
      img.onload = () =&gt; {
        var canvas = document.createElement(&quot;canvas&quot;);
        var ctx = canvas.getContext(&quot;2d&quot;);
        var scale = Math.max(img.width / width, img.height / height, 1);
        canvas.width = img.width / scale;
        canvas.height = img.height / scale;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        resolve(canvas.toDataURL(&quot;image/jpeg&quot;, quality));
      };
    };
  });
}

</code></pre>
</article></div></div><footer id="footer"><div class="container"><div class="copy">Copyright &copy; 2023 Ray0324</div><nav><a href="/">首页</a><a href="/archives/">归档</a><a href="/tags/">标签</a><a href="/about/">关于</a></nav></div></footer><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/highlight/highlight.pack.js"></script><script src="/lib/push.js"></script><script src="/js/nano.js"></script></body></html>
<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><title>使用Letsencrypt为Nginx添加https支持</title><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/lib/highlight/styles/atom-one-dark.css"></head><body><header class="navbar navbar-fixed"><div class="navbar-nav"><div class="container"><a class="brand"></a><ul><li><a href="/">首页</a></li><li><a href="/archives/">归档</a></li><li><a href="/tags/">标签</a></li><li><a href="/about/">关于</a></li></ul></div></div><div class="navbar-line"><div class="navbar-wrap"><div class="container current"><div class="cur"></div></div></div></div></header><div class="main"><div class="container post"><h1>使用Letsencrypt为Nginx添加https支持</h1><div class="meta"><time>2018-04-30</time><div class="tags"><a class="tag-link" href="/tags/Nginx/">Nginx </a><a class="tag-link" href="/tags/Letsencrypt/">Letsencrypt </a></div></div><article id="markdown"><blockquote>
<p>使用EFF的Certbot为你的网站自动添加Let‘s Encrypt证书</p>
</blockquote>
<p>在https快速普及的今天，有必要为我们http服务添加一层tls加密。这里我们使用免费的letsencrypt来签发https证书。以下粗略记录了在服务端配置的详细过程。</p>
<h2 id="一、安装-Certbot"><a href="#一、安装-Certbot" class="headerlink" title="一、安装 Certbot"></a>一、安装 Certbot</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>这里采用的是安装CentOS 7.4的阿里云服务器，操作系统为<code>CentOS 7.4</code>,Web服务器软件为<code>Nginx</code>。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre><code class="bash">yum -y install yum-utils
yum-config-manager --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional
sudo yum install certbot-nginx
</code></pre>
<p>然后使用以下命令自动安装并配置Nginx。</p>
<pre><code class="bash">sudo certbot --nginx -d yourdomain.com
</code></pre>
<p>如果我们只想生成证书，手工配置nginx，则使用</p>
<pre><code class="bash">sudo certbot --nginx certonly -d yourdomain.com
</code></pre>
<h2 id="二、配置nginx"><a href="#二、配置nginx" class="headerlink" title="二、配置nginx"></a>二、配置nginx</h2><pre><code class="conf">server {
    listen 80;
    listen [::]:80;
    server_name yourdomain.com;
    return 301 https://$host$request_uri;
}


server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name yourdomain.com;
    root /usr/share/nginx/html;

    # certs sent to the client in SERVER HELLO are concatenated in ssl_certificate
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;

    # Diffie-Hellman parameter for DHE ciphersuites, recommended 2048 bits
    #ssl_dhparam /path/to/dhparam.pem;

    # intermediate configuration. tweak to your needs.
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers &#39;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&#39;;
    ssl_prefer_server_ciphers on;

    # HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)
    add_header Strict-Transport-Security max-age=15768000;

    # OCSP Stapling ---
    # fetch OCSP records from URL in ssl_certificate and cache them
    ssl_stapling on;
    ssl_stapling_verify on;

    resolver 8.8.8.8;
}
</code></pre>
<h2 id="三、-证书自动续期"><a href="#三、-证书自动续期" class="headerlink" title="三、 证书自动续期"></a>三、 证书自动续期</h2><p>Let’s Encrypt申请的证书会有三个月的有效期，可以到期前手动续约。</p>
<h3 id="使用certbot自带服务"><a href="#使用certbot自带服务" class="headerlink" title="使用certbot自带服务"></a>使用certbot自带服务</h3><pre><code>systemctl start certbot-renew.service
systemctl start certbot-renew.timer
systemctl enable certbot-renew.timer
systemctl list-timers

</code></pre><p><a href="https://www.youtube.com/watch?v=eHVc08HVTwI" target="_blank" rel="noopener">参考视频(需要翻墙)</a></p>
</article></div></div><footer id="footer"><div class="container"><div class="copy">Copyright &copy; 2021 Ray0324</div><nav><a href="/">首页</a><a href="/archives/">归档</a><a href="/tags/">标签</a><a href="/about/">关于</a></nav></div></footer><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/highlight/highlight.pack.js"></script><script src="/lib/push.js"></script><script src="/js/nano.js"></script></body></html>